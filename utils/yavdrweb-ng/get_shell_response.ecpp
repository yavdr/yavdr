<%pre>
#include <stdio.h>
#include <string>

using namespace std;
</%pre><& authenticate ><%args>
command;
</%args><%cpp>
reply.setHeader ("Cache-Control", "no-cache", false);

//restrict commands

if (command == "ifconfig" || command == "top" || command == "df" || command == "aplay" || command == "dmesg" )
{
    string cmd = command;
    if (command == "top")
       cmd += " -b -n1";
    else if (command == "df")
        cmd += " -h";
    else if (command == "aplay")
        cmd += " -L";

    
    if (FILE *stream = popen(cmd.c_str(), "r"))
    {
        reply.out() << "<pre>";
        char buffer[1024];
        while (!feof(stream))
        {
          if (fgets(buffer, sizeof(buffer), stream) != NULL)
          {
               reply.sout() << string(buffer).substr(0, strlen(buffer) - 1 ); //we must escape special chars via sout (xss)
               reply.out() << "<br/>";
          }
        }
        pclose(stream); 
        reply.out() << "</pre>";
    }
}
else
    reply.out() << "Illegal command.";

</%cpp>

