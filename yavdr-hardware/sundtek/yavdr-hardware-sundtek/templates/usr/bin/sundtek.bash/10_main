
if [ "$1" = "ATTACH" ]; then
    ADAPTER=$(/opt/bin/mediaclient -e | (
        DEVID=$2
        FRONTEND=0
    
        FOUND_DEV=0
        while IFS=: read first rest; do
            if [ $FOUND_DEV -eq 1 ]; then
                if [ "x${first:0:6}" == "xdevice" ]; then
                    break;
                fi
                if [ "x$first" == "x     FRONTEND" ]; then
                    RESULT=$(echo $rest |\
                        sed -e "s/\/dev\/dvb\/adapter\([0-9]\)\/frontend$FRONTEND/\\1/" |\
                        sed -e "s/^[^0-9].*//")
        
                    if [ -n "$RESULT" ]; then
                        echo -n $RESULT
                        break;
                    fi
                fi
            fi
            if [ "x$first" == "xdevice $DEVID" ]; then
                FOUND_DEV=1
            fi
        done
    ))
    
    if [ -n "$ADAPTER" ]; then
        # holgerr: sundtek needs additional time to start up
        sleep 2
        
        dbset "system.hardware.sundtek.$DEVID.adapter=$ADAPTER"
        MODE="$(dbget system.hardware.sundtek.$DEVID.mode)"
        if [ -n "$MODE" ]; then
          logger -t "sundtek" set mode $MODE
          /opt/bin/mediaclient -d /dev/dvb/adapter$ADAPTER/frontend0 -D $MODE -m $MODE
        fi
        svdrpsend plug dynamite attd /dev/dvb/adapter$ADAPTER/frontend0
        logger -t "sundtek" attached device $2 as /dev/dvb/adapter$ADAPTER finished
    else
        logger -t "sundtek" device $2 not found
    fi
elif [ "$1" = "DETACH" ]; then
    logger -t "sundtek" detached device $2
    dbset "system.hardware.sundtek.$2.adapter=removed"
elif [ "$1" = "PRESENT" ]; then
    logger -t "sundtek" adapter is present
    dbset "system.hardware.sundtek.$2.adapter=present"
fi
